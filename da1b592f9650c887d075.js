import"./styles.css";import{format,formatDistance,formatRelative,subDays}from"date-fns";import{icons}from"./iconsSVG.js";const form=document.querySelector("form"),searchInput=document.getElementById("search"),submitBtn=document.getElementById("submit-btn"),weatherSummary=document.querySelector(".weather-summary"),weatherLocation=document.querySelector(".location"),weatherTemp=document.querySelector(".temperatures"),weatherCondition=document.querySelector(".conditions"),weatherIcon=document.getElementById("icon");weatherIcon.className="weather-icon";const hourlyWeather=document.querySelector("hourly-weather"),weatherDescr=document.querySelector(".description"),weatherHours=document.querySelector(".hours"),weatherForecast=document.querySelector(".forecast"),scaleChange=document.getElementById("scale");let currentCity="Durban";function searchWeather(e){getWeatherData(e).then((e=>(console.log(e),processWeatherDataObj(e)))).then((e=>{console.log("Obj: "+e.fiveDays[0]),displayWeather(e)}))}async function getWeatherData(e){currentCity=e;const t=`https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/${e}?key=XGB7KF9RWZ2BQX5L49KB3TCRP`,n=await fetch(t,{mode:"cors"}),o=await n.json();return console.log(o),o}function cToF(e){return Math.ceil(9*e/5+32)}function fToC(e){return Math.ceil(5/9*(e-32))}async function processWeatherDataObj(e){const t=[];return await new Promise((n=>{const o=e.days[0].hours,r=[];let c;for(o.forEach(((e,t)=>{let n;n=t<10?`0${t}:00`:`${t}:00`;let o={hour:n,icon:e.icon,tempSign:"C",temp:{F:e.temp,C:fToC(e.temp)}};r.push(o)})),c=0;c<8;c++){let n=e.days[c],o={date:format(new Date(n.datetime),"eeee"),tempSign:"C",temp:{F:n.temp,C:fToC(n.temp)},icon:n.icon,summary:n.conditions};t.push(o)}return n({tempSign:"C",temp:{F:e.currentConditions.temp,C:fToC(e.currentConditions.temp)},hourly:r,fiveDays:t,conditions:e.currentConditions.conditions,feelsLike:e.currentConditions.feelslike,humidity:e.currentConditions.humidity,icon:e.currentConditions.icon,precipitation:e.currentConditions.precip,precipProb:e.currentConditions.precipprob,uvIndex:e.currentConditions.uvindex,windSpeed:e.currentConditions.windspeed,dateTime:e.currentConditions.datetime,description:e.description,city:e.resolvedAddress})}))}function displayWeather(e){console.log(`******Your Weather for Today in ${e.city} ******`),weatherLocation.textContent=`${e.city}`,"C"===scaleChange.value?(console.log(`Temperature: ${e.temp.C}`),weatherTemp.textContent=`${e.temp.C}° C`):(console.log(`Temperature: ${e.temp.F}`),weatherTemp.textContent=`${e.temp.F}° F`),console.log(`Conditions: ${e.conditions}`),weatherCondition.textContent=`${e.conditions}`,weatherIcon.src=icons[e.icon],console.log(`Icon: ${e.icon}`),console.log(`Time: ${e.dateTime} ${e.fiveDays[0].date}`),console.log(`Rain Probability: ${e.precipProb}`),console.log("********Hourly updates*******"),weatherDescr.textContent=e.description,weatherHours.replaceChildren("");for(let t=0;t<24;t++)console.log(`Hour: ${e.hourly[t].hour} - Temp: ${e.hourly[t].temp} - Icon: ${e.hourly[t].icon}`),displayHourWeather(e.hourly[t]);console.log("*******Next Five Days*******"),weatherForecast.replaceChildren("");for(let t=1;t<8;t++)console.log(`Day: ${e.fiveDays[t].date} - Temp: ${e.fiveDays[t].temp} - Condition: ${e.fiveDays[t].summary}`),displayForecast(e.fiveDays[t])}function displayHourWeather(e){let t=document.createElement("div");t.classList.add("hourDiv");let n=document.createElement("h4"),o=document.createElement("h6"),r=document.createElement("img");r.className="hour-icon",r.src=icons[e.icon],t.appendChild(n),t.appendChild(r),t.appendChild(o),weatherHours.appendChild(t),n.textContent=e.hour,"C"===scaleChange.value?o.textContent=`${e.temp.C}° C`:o.textContent=`${e.temp.F}° F`}function displayForecast(e){let t=document.createElement("div");t.classList.add("nextDayDiv"),weatherForecast.appendChild(t);let n=document.createElement("h4"),o=document.createElement("h3"),r=document.createElement("img");r.className="next-day-icon",r.src=icons[e.icon];let c=document.createElement("p");t.appendChild(n),t.appendChild(o),t.appendChild(r),t.appendChild(c),n.textContent=e.date,"C"===scaleChange.value?o.textContent=`${e.temp.C}° C`:o.textContent=`${e.temp.F}° F`,c.textContent=e.summary}scaleChange.addEventListener("change",(e=>{searchWeather(currentCity)})),submitBtn.addEventListener("click",(e=>{e.preventDefault(),searchWeather(searchInput.value)})),searchInput.addEventListener("keyup",(e=>{searchWeather(searchInput.value)}));